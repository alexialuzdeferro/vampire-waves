<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vampire Waves</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- React & ReactDOM -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js" crossorigin></script>
    <!-- Babel para compilar JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700&family=Playfair+Display:ital,wght@0,400;0,700;1,400&display=swap');
        
        .gothic-font { font-family: 'Cinzel', serif; }
        .serif-font { font-family: 'Playfair Display', serif; }
        
        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #1a0505; }
        ::-webkit-scrollbar-thumb { background: #4a0404; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #8a0000; }

        /* CRT Effect */
        .crt-overlay {
            background: linear-gradient(rgba(18, 16, 16, 0) 50%, rgba(0, 0, 0, 0.25) 50%), 
                        linear-gradient(90deg, rgba(255, 0, 0, 0.06), rgba(0, 255, 0, 0.02), rgba(0, 0, 255, 0.06));
            background-size: 100% 2px, 3px 100%;
            pointer-events: none;
        }
        
        .animate-spin-slow { animation: spin 4s linear infinite; }
        @keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
    </style>
</head>
<body class="bg-[#050101] text-[#e0e0e0] font-sans relative overflow-x-hidden selection:bg-[#8a0000] selection:text-white">
    <div id="root"></div>

    <script type="text/babel">
        const CONFIG = {
            SUPABASE_URL: 'https://rbygxkbewzknvjjhxdvw.supabase.co',
            SUPABASE_KEY: 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InJieWd4a2Jld3prbnZqamh4ZHZ3Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjYwMDcxNjQsImV4cCI6MjA4MTU4MzE2NH0.YrHF9HEGo6yv9MyNsPzFgBhaAB1DRh2SLU8f7L6s1nY',
            PAGE_NAME: 'nocturne-player',
            SESSION_KEY: 'page_visit_nocturne'
        };

        const { useState, useEffect, useRef } = React;

        // Componente do Contador de Acessos
        function AccessCounter() {
            const [accessCount, setAccessCount] = useState(0);
            const [isVisible, setIsVisible] = useState(false);

            useEffect(() => {
                // Verificar se jÃ¡ visitou nesta sessÃ£o
                const hasVisited = sessionStorage.getItem(CONFIG.SESSION_KEY);
                
                if (!hasVisited) {
                    // Marcar como visitado
                    sessionStorage.setItem(CONFIG.SESSION_KEY, 'true');
                    
                    // Registrar acesso no Supabase
                    registerAccess();
                }

                // Buscar contagem total de acessos
                fetchAccessCount();
                
                // Mostrar contador apÃ³s carregar
                setTimeout(() => setIsVisible(true), 1000);
            }, []);

            const registerAccess = async () => {
                try {
                    await fetch(`${CONFIG.SUPABASE_URL}/rest/v1/page_visits`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'apikey': CONFIG.SUPABASE_KEY,
                            'Authorization': `Bearer ${CONFIG.SUPABASE_KEY}`,
                            'Prefer': 'return=minimal'
                        },
                        body: JSON.stringify({
                            page_name: CONFIG.PAGE_NAME,
                            visited_at: new Date().toISOString()
                        })
                    });
                } catch (error) {
                    console.log('Erro ao registrar acesso:', error);
                }
            };

            const fetchAccessCount = async () => {
                try {
                    const response = await fetch(
                        `${CONFIG.SUPABASE_URL}/rest/v1/page_visits?page_name=eq.${CONFIG.PAGE_NAME}&select=count`,
                        {
                            headers: {
                                'apikey': CONFIG.SUPABASE_KEY,
                                'Authorization': `Bearer ${CONFIG.SUPABASE_KEY}`
                            }
                        }
                    );
                    
                    const data = await response.json();
                    if (data && data.length > 0) {
                        setAccessCount(data[0].count || 0);
                    }
                } catch (error) {
                    console.log('Erro ao buscar contador:', error);
                }
            };

            return (
                <div className={`fixed bottom-4 right-4 z-50 transition-opacity duration-1000 ${isVisible ? 'opacity-100' : 'opacity-0'}`}>
                    <div className="flex items-center gap-2 text-[#5c3a4a] text-xs hover:text-[#8a0000] transition-colors cursor-default">
                        <div className="flex items-center">
                            <span className="mr-1 text-[10px] opacity-70">ðŸ”®</span>
                            <span className="font-mono">{accessCount.toLocaleString()}</span>
                        </div>
                    </div>
                </div>
            );
        }

        // Ãcones
        const Disc = ({ className }) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><circle cx="12" cy="12" r="10"/><circle cx="12" cy="12" r="3"/></svg>;
        const SkipBack = ({ className }) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><polygon points="19 20 9 12 19 4 19 20"/><line x1="5" y1="19" x2="5" y2="5"/></svg>;
        const SkipForward = ({ className }) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><polygon points="5 4 15 12 5 20 5 4"/><line x1="19" y1="5" x2="19" y2="19"/></svg>;
        const Music = ({ className }) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M9 18V5l12-2v13"/><circle cx="6" cy="18" r="3"/><circle cx="18" cy="16" r="3"/></svg>;
        const Volume2 = ({ className }) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"/><path d="M19.07 4.93a10 10 0 0 1 0 14.14"/><path d="M15.54 8.46a5 5 0 0 1 0 7.07"/></svg>;
        const Heart = ({ className }) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"/></svg>;
        const Repeat = ({ className }) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><polyline points="17 1 21 5 17 9"></polyline><path d="M3 11V9a4 4 0 0 1 4-4h14"></path><polyline points="7 23 3 19 7 15"></polyline><path d="M21 13v2a4 4 0 0 1-4 4H3"></path></svg>;

        const videos = [
          { id: '-HeCgOiirV4', title: 'Ritual Inicial' },
          { id: 'tBpQ1f77PDA', title: 'The Perfect Girl' },
          { id: 'h4Jnv-pb6sk', title: 'Silhouette' },
          { id: 'A_ZJnKoMoBA', title: 'After Dark' },
          { id: '9CvpeDHgCpo', title: 'Goth' },
          { id: 'LHUz8vA_wCM', title: 'Sudno' },
          { id: 'bIGoN8_vv_Y', title: 'Little Dark Age' },
          { id: 'npQwX2X3WBE', title: 'Resonance' },
          { id: 'qLQ0PZ-Zwc8', title: 'Vampire' },
          { id: 'bjxfcGJM3V4', title: 'Dark Beach' },
          { id: 'DOzdBjtA9H0', title: 'Nightcall' },
          { id: 'qFtiH1bZuJ0', title: 'SimpsonWave' },
          { id: 'FaHMRB30HmA', title: 'Gallowdance' },
          { id: 'VdAlPCrndT8', title: 'Crimson' },
          { id: 'gebchYvcp2s', title: 'Shadows' },
          { id: '77GxLUUEcHo', title: 'Insomnia' },
          { id: 'bYM8iPn47yE', title: 'Eternal' },
          { id: 'bpxKOOUhLs8', title: 'Void' },
          // Novas Faixas Adicionadas
          { id: 'y0AaKrZLFQo', title: 'Kletka' },
          { id: 'LVQi3iyx_Hc', title: 'Tears (Don\'t Believe)' },
          { id: 'ElcwzDwdYkA', title: 'Tancevat' },
          { id: 'F3VwhAe7Ks0', title: 'Gorod' },
          { id: 'mwooX2qXrwE', title: 'Calm Night' },
          { id: 'lAt6qFZby5w', title: 'Tancuy' },
          { id: 'Wj1r0bU3pkg', title: 'Passion' },
          { id: '5zS9CbU1gxY', title: 'Things I Don\'t Need' },
          { id: 'pO4lvJUwrwk', title: 'Babes of the 80s' },
          { id: 'X8wAX8uZHi8', title: 'Kasvetli Kutlama' },
          { id: '4AcNJQYb0Rw', title: 'Pain' },
          { id: '6170iawsQHE', title: 'The Perfect Girl (Alt)' }
        ];

        function App() {
          const [currentVideoIndex, setCurrentVideoIndex] = useState(0);
          const [isPlaying, setIsPlaying] = useState(false);
          const [isAutoPlay, setIsAutoPlay] = useState(false);
          const playerRef = useRef(null);
          const playerContainerRef = useRef(null);
          
          const isAutoPlayRef = useRef(isAutoPlay);
          const currentVideoIndexRef = useRef(currentVideoIndex);

          useEffect(() => {
            isAutoPlayRef.current = isAutoPlay;
            currentVideoIndexRef.current = currentVideoIndex;
          }, [isAutoPlay, currentVideoIndex]);

          useEffect(() => {
            if (!window.YT) {
              const tag = document.createElement('script');
              tag.src = "https://www.youtube.com/iframe_api";
              const firstScriptTag = document.getElementsByTagName('script')[0];
              firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);
            }

            window.onYouTubeIframeAPIReady = () => {
              playerRef.current = new window.YT.Player('youtube-player', {
                height: '100%',
                width: '100%',
                videoId: videos[0].id,
                playerVars: {
                  'autoplay': 0,
                  'controls': 1,
                  'rel': 0,
                  'fs': 1,
                  'modestbranding': 1,
                  'playsinline': 1 
                },
                events: {
                  'onStateChange': onPlayerStateChange
                }
              });
            };
          }, []);

          useEffect(() => {
            if (playerRef.current && playerRef.current.loadVideoById) {
              playerRef.current.loadVideoById(videos[currentVideoIndex].id);
              setIsPlaying(true);
            }
          }, [currentVideoIndex]);

          const onPlayerStateChange = (event) => {
             if (event.data === 0) {
               setIsPlaying(false);
               if (isAutoPlayRef.current) {
                 const nextIndex = (currentVideoIndexRef.current + 1) % videos.length;
                 setCurrentVideoIndex(nextIndex);
               }
             } else if (event.data === 1) { 
               setIsPlaying(true);
             } else if (event.data === 2) { 
               setIsPlaying(false);
             }
          };

          const handleVideoSelect = (index) => {
            setCurrentVideoIndex(index);
            if (window.innerWidth < 1024 && playerContainerRef.current) {
                playerContainerRef.current.scrollIntoView({ behavior: 'smooth', block: 'start' });
            }
          };

          const handleNext = () => {
            setCurrentVideoIndex((prev) => (prev + 1) % videos.length);
          };

          const handlePrev = () => {
            setCurrentVideoIndex((prev) => (prev - 1 + videos.length) % videos.length);
          };

          const toggleAutoPlay = () => {
            setIsAutoPlay(!isAutoPlay);
          };

          const currentVideo = videos[currentVideoIndex];

          return (
            <div className="min-h-screen pb-10">
              
              <AccessCounter />
              
              <div className="fixed inset-0 pointer-events-none z-0">
                <div className="absolute top-[-10%] left-[-10%] w-[50%] h-[50%] bg-[#4a0404] rounded-full blur-[120px] opacity-20 animate-pulse"></div>
                <div className="absolute bottom-[-10%] right-[-10%] w-[50%] h-[50%] bg-[#2d004d] rounded-full blur-[120px] opacity-20 animate-pulse delay-1000"></div>
                <div className="absolute top-[40%] left-[40%] w-[30%] h-[30%] bg-[#8a0000] rounded-full blur-[150px] opacity-10"></div>
                <div className="crt-overlay absolute inset-0 z-50 opacity-20"></div>
              </div>

              <div className="relative z-10 container mx-auto px-4 py-8 max-w-5xl">
                
                {/* Header Ajustado */}
                <header className="mb-8 text-center border-b border-[#3d0a0a] pb-6">
                  <h1 className="gothic-font text-4xl sm:text-5xl md:text-7xl bg-gradient-to-r from-[#ff0033] via-[#b026ff] to-[#ff0033] bg-clip-text text-transparent drop-shadow-[0_0_15px_rgba(138,0,0,0.5)] tracking-wider">
                    NOCTURNE
                  </h1>
                  <p className="gothic-font text-[#a37996] mt-2 tracking-[0.2em] text-xs md:text-sm uppercase opacity-80">
                    Sinfonia das Sombras
                  </p>
                </header>

                <div className="grid grid-cols-1 lg:grid-cols-3 gap-8 mb-12">
                  
                  <div className="lg:col-span-2 space-y-4" ref={playerContainerRef}>
                    <div className="relative w-full aspect-video bg-black rounded-sm border-2 border-[#2d0a1e] shadow-[0_0_30px_rgba(45,0,20,0.6)] overflow-hidden group">
                      <div id="youtube-player" className="w-full h-full"></div>
                      <div className="absolute inset-0 border-[1px] border-[#ffffff10] pointer-events-none"></div>
                    </div>

                    <div className="bg-[#0f0205] border border-[#2e0212] p-4 md:p-6 rounded-sm shadow-lg flex flex-col gap-4">
                      
                      <div className="flex items-center gap-4 w-full">
                        <div className={`p-3 rounded-full bg-[#1a0505] border border-[#3d0a0a] ${isPlaying ? 'animate-spin-slow' : ''}`}>
                          <Disc className="w-6 h-6 text-[#ff0033]" />
                        </div>
                        <div className="overflow-hidden flex-1">
                          <h2 className="serif-font text-xl md:text-2xl text-[#decbcb] truncate">{currentVideo.title}</h2>
                          <p className="text-xs text-[#804d5e] uppercase tracking-widest">
                             {isPlaying ? 'Reproduzindo Agora' : 'Pausado'}
                          </p>
                        </div>
                      </div>

                      <div className="flex items-center justify-between border-t border-[#2e0212] pt-4">
                        <button 
                          onClick={toggleAutoPlay}
                          className={`flex items-center gap-2 px-3 py-1 rounded-sm text-xs uppercase tracking-wider transition-all
                            ${isAutoPlay 
                              ? 'bg-[#2d0a1e] text-[#b026ff] border border-[#b026ff]/30 shadow-[0_0_10px_rgba(176,38,255,0.2)]' 
                              : 'text-[#5c3a4a] hover:text-[#a0a0a0]'}
                          `}
                        >
                          <Repeat className="w-3 h-3" />
                          {isAutoPlay ? 'SessÃ£o ContÃ­nua: ON' : 'Tocar Todas: OFF'}
                        </button>

                        <div className="flex items-center gap-4">
                            <button 
                            onClick={handlePrev}
                            className="p-3 text-[#5e2d3e] hover:text-[#ff0033] transition-colors hover:bg-[#1a0505] rounded-full"
                            >
                            <SkipBack className="w-6 h-6" />
                            </button>
                            <div className="w-px h-6 bg-[#2e0212]"></div>
                            <button 
                            onClick={handleNext}
                            className="p-3 text-[#5e2d3e] hover:text-[#ff0033] transition-colors hover:bg-[#1a0505] rounded-full"
                            >
                            <SkipForward className="w-6 h-6" />
                            </button>
                        </div>
                      </div>
                    </div>
                  </div>

                  <div className="lg:col-span-1">
                    <div className="bg-[#0a0103]/80 backdrop-blur-sm border border-[#2e0212] h-[500px] lg:h-[600px] flex flex-col rounded-sm">
                      <div className="p-4 border-b border-[#2e0212] bg-[#120205]">
                        <h3 className="gothic-font text-xl text-[#b026ff] flex items-center gap-2">
                          <Music className="w-4 h-4" /> Playlist GÃ³tica
                        </h3>
                        <p className="text-xs text-gray-500 mt-1">{videos.length} Faixas â€¢ Clique para tocar</p>
                      </div>
                      
                      <div className="overflow-y-auto flex-1 p-2 space-y-2">
                        {videos.map((video, index) => (
                          <div 
                            key={video.id}
                            onClick={() => handleVideoSelect(index)}
                            className={`
                              group flex items-center gap-3 p-2 rounded-sm cursor-pointer border border-transparent transition-all duration-300
                              ${currentVideoIndex === index 
                                ? 'bg-[#1f050a] border-[#4a0404] shadow-[0_0_10px_rgba(138,0,0,0.2)]' 
                                : 'hover:bg-[#120408] hover:border-[#2e0212]'}
                            `}
                          >
                            <div className="relative w-16 h-12 flex-shrink-0 overflow-hidden rounded-sm border border-[#1f050a]">
                              <img 
                                src={`https://img.youtube.com/vi/${video.id}/mqdefault.jpg`} 
                                alt="thumbnail" 
                                className="w-full h-full object-cover group-hover:scale-110 transition-transform duration-500 opacity-80 group-hover:opacity-100"
                              />
                              {currentVideoIndex === index && (
                                <div className="absolute inset-0 bg-black/50 flex items-center justify-center">
                                  <Volume2 className="w-4 h-4 text-[#ff0033] animate-pulse" />
                                </div>
                              )}
                            </div>
                            
                            <div className="flex-1 min-w-0">
                              <p className={`serif-font text-sm truncate ${currentVideoIndex === index ? 'text-[#ffb3c1]' : 'text-[#a0a0a0] group-hover:text-[#decbcb]'}`}>
                                {video.title}
                              </p>
                              <p className="text-[10px] text-[#5c3a4a] uppercase tracking-wider group-hover:text-[#b026ff] transition-colors">
                                {currentVideoIndex === index ? 'Tocando...' : `Faixa ${index + 1}`}
                              </p>
                            </div>
                          </div>
                        ))}
                      </div>
                    </div>
                  </div>

                </div>

                <footer className="text-center py-8 border-t border-[#3d0a0a] mt-8">
                  <div className="flex justify-center items-center gap-2 text-[#5c3a4a] text-sm hover:text-[#ff0033] transition-colors cursor-default">
                    <Heart className="w-3 h-3" />
                    <span className="serif-font tracking-widest">CRIADO NA ESCURIDÃƒO</span>
                    <Heart className="w-3 h-3" />
                  </div>
                </footer>

              </div>
            </div>
          );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
