import React, { useState, useEffect } from 'react';
import { Play, Pause, SkipBack, SkipForward, Volume2, Skull, Zap } from 'lucide-react';

const GothicMusicPlayer = () => {
  const [currentTrack, setCurrentTrack] = useState(0);
  const [isPlaying, setIsPlaying] = useState(false);
  const [theme, setTheme] = useState('dark');
  const [playAllMode, setPlayAllMode] = useState(false);
  const [audioBars, setAudioBars] = useState(Array(20).fill(0).map(() => Math.random()));

  const tracks = [
    { id: 1, title: "Shadowlands", artist: "The Cure", duration: "4:23", color: "#DC143C" },
    { id: 2, title: "Melancholic Dreams", artist: "Joy Division", duration: "3:58", color: "#8B008B" },
    { id: 3, title: "Nocturnal Whispers", artist: "Bauhaus", duration: "5:12", color: "#6A0DAD" },
    { id: 4, title: "Endless Night", artist: "Siouxsie", duration: "4:45", color: "#B22222" },
    { id: 5, title: "Gothic Pulse", artist: "Sisters of Mercy", duration: "3:34", color: "#9400D3" },
    { id: 6, title: "Dark Wave", artist: "Clan of Xymox", duration: "4:18", color: "#8B0000" },
    { id: 7, title: "Midnight Ritual", artist: "The Mission", duration: "5:02", color: "#DC143C" },
    { id: 8, title: "Cold Embrace", artist: "Fields of Nephilim", duration: "4:56", color: "#4B0082" },
    { id: 9, title: "Eternal Sorrow", artist: "Christian Death", duration: "3:41", color: "#8B008B" },
    { id: 10, title: "Phantom Dance", artist: "The Chameleons", duration: "4:29", color: "#6A0DAD" },
    { id: 11, title: "Velvet Darkness", artist: "Cocteau Twins", duration: "3:52", color: "#B22222" },
    { id: 12, title: "Lost Souls", artist: "Dead Can Dance", duration: "5:23", color: "#9400D3" },
    { id: 13, title: "Bleeding Heart", artist: "Echo & Bunnymen", duration: "4:11", color: "#DC143C" },
    { id: 14, title: "Crimson Tears", artist: "This Mortal Coil", duration: "3:47", color: "#8B0000" },
    { id: 15, title: "Desolation", artist: "New Order", duration: "4:38", color: "#4B0082" },
    { id: 16, title: "Lunar Eclipse", artist: "The Sound", duration: "4:04", color: "#8B008B" },
    { id: 17, title: "Forbidden Night", artist: "Modern English", duration: "3:55", color: "#6A0DAD" },
    { id: 18, title: "Silent Scream", artist: "Gene Loves Jezebel", duration: "4:27", color: "#B22222" }
  ];

  useEffect(() => {
    if (isPlaying) {
      const interval = setInterval(() => {
        setAudioBars(Array(20).fill(0).map(() => Math.random()));
      }, 150);
      return () => clearInterval(interval);
    }
  }, [isPlaying]);

  const currentColor = tracks[currentTrack].color;

  const getThemeClasses = () => {
    switch(theme) {
      case 'light':
        return {
          bg: 'bg-gray-100',
          card: 'bg-white',
          text: 'text-gray-900',
          secondary: 'text-gray-600'
        };
      case 'purple':
        return {
          bg: 'bg-gradient-to-br from-purple-950 via-purple-900 to-black',
          card: 'bg-purple-900/50',
          text: 'text-purple-50',
          secondary: 'text-purple-300'
        };
      default:
        return {
          bg: 'bg-gradient-to-br from-gray-900 via-black to-gray-900',
          card: 'bg-gray-800/50',
          text: 'text-gray-100',
          secondary: 'text-gray-400'
        };
    }
  };

  const themeClasses = getThemeClasses();

  return (
    <div className={`min-h-screen ${themeClasses.bg} ${themeClasses.text} transition-all duration-700 p-6`}>
      
      {/* Theme Switcher */}
      <div className="flex justify-end gap-3 mb-6">
        <button
          onClick={() => setTheme('dark')}
          className={`w-10 h-10 rounded-full bg-gray-900 border-4 transition-all ${theme === 'dark' ? 'border-red-500 scale-110' : 'border-gray-700'} hover:scale-110`}
          title="Tema Escuro"
        />
        <button
          onClick={() => setTheme('light')}
          className={`w-10 h-10 rounded-full bg-white border-4 transition-all ${theme === 'light' ? 'border-purple-500 scale-110' : 'border-gray-300'} hover:scale-110`}
          title="Tema Claro"
        />
        <button
          onClick={() => setTheme('purple')}
          className={`w-10 h-10 rounded-full bg-gradient-to-br from-purple-600 to-purple-900 border-4 transition-all ${theme === 'purple' ? 'border-yellow-400 scale-110' : 'border-purple-700'} hover:scale-110`}
          title="Tema Roxo"
        />
      </div>

      <div className="max-w-5xl mx-auto">
        
        {/* Main Player */}
        <div 
          className={`${themeClasses.card} backdrop-blur-xl rounded-3xl shadow-2xl p-8 border-4 transition-all duration-500`}
          style={{ 
            borderColor: currentColor,
            boxShadow: `0 0 60px ${currentColor}60, 0 20px 40px rgba(0,0,0,0.5)`
          }}
        >
          
          {/* Visualizer */}
          <div 
            className="relative w-80 h-80 mx-auto mb-8 rounded-3xl overflow-hidden transition-all duration-500 shadow-2xl"
            style={{ 
              background: `radial-gradient(circle at center, ${currentColor}60, ${currentColor}20, #00000090)`,
              boxShadow: `0 0 80px ${currentColor}80, inset 0 0 100px ${currentColor}40`
            }}
          >
            {/* Audio Bars */}
            <div className="absolute inset-0 flex items-end justify-center gap-1 p-6">
              {audioBars.map((height, i) => (
                <div
                  key={i}
                  className="flex-1 rounded-t-xl transition-all duration-150 shadow-lg"
                  style={{
                    height: isPlaying ? `${Math.max(height * 100, 10)}%` : '5%',
                    backgroundColor: currentColor,
                    opacity: isPlaying ? 0.9 : 0.2,
                    boxShadow: isPlaying ? `0 0 20px ${currentColor}` : 'none'
                  }}
                />
              ))}
            </div>
            
            {/* Center Skull */}
            <div className="absolute inset-0 flex items-center justify-center">
              <Skull 
                size={120} 
                className={`${isPlaying ? 'animate-pulse' : ''} drop-shadow-2xl`}
                style={{ 
                  color: currentColor,
                  filter: `drop-shadow(0 0 30px ${currentColor})`
                }}
              />
            </div>
          </div>

          {/* Track Info */}
          <div className="text-center mb-8">
            <h1 className="text-4xl font-bold mb-3 animate-pulse" style={{ color: currentColor }}>
              {tracks[currentTrack].title}
            </h1>
            <p className={`text-xl ${themeClasses.secondary} mb-2`}>
              {tracks[currentTrack].artist}
            </p>
            <p className={`text-sm ${themeClasses.secondary} opacity-70`}>
              {tracks[currentTrack].duration}
            </p>
          </div>

          {/* Progress Bar */}
          <div className="mb-8 px-4">
            <div className="h-3 bg-black/30 rounded-full overflow-hidden backdrop-blur-sm">
              <div 
                className="h-full rounded-full transition-all duration-1000 shadow-lg"
                style={{ 
                  width: isPlaying ? '65%' : '0%',
                  backgroundColor: currentColor,
                  boxShadow: `0 0 20px ${currentColor}`
                }}
              />
            </div>
          </div>

          {/* Main Controls */}
          <div className="flex items-center justify-center gap-6 mb-8">
            <button
              onClick={() => {
                setIsPlaying(false);
                setTimeout(() => {
                  setCurrentTrack((prev) => (prev - 1 + tracks.length) % tracks.length);
                  setIsPlaying(true);
                }, 100);
              }}
              className="p-5 rounded-full bg-gray-700/80 backdrop-blur-sm hover:bg-gray-600 transition-all hover:scale-110 shadow-xl"
            >
              <SkipBack size={28} />
            </button>
            
            <button
              onClick={() => setIsPlaying(!isPlaying)}
              className="p-8 rounded-full transition-all hover:scale-110 shadow-2xl"
              style={{ 
                backgroundColor: currentColor,
                boxShadow: `0 0 40px ${currentColor}, 0 10px 30px rgba(0,0,0,0.5)`
              }}
            >
              {isPlaying ? <Pause size={40} /> : <Play size={40} className="ml-1" />}
            </button>
            
            <button
              onClick={() => {
                setIsPlaying(false);
                setTimeout(() => {
                  setCurrentTrack((prev) => (prev + 1) % tracks.length);
                  setIsPlaying(true);
                }, 100);
              }}
              className="p-5 rounded-full bg-gray-700/80 backdrop-blur-sm hover:bg-gray-600 transition-all hover:scale-110 shadow-xl"
            >
              <SkipForward size={28} />
            </button>
          </div>

          {/* Special Buttons */}
          <div className="flex items-center justify-center gap-4 mb-8">
            <button
              onClick={() => {
                const randomIndex = Math.floor(Math.random() * tracks.length);
                setIsPlaying(false);
                setTimeout(() => {
                  setCurrentTrack(randomIndex);
                  setIsPlaying(true);
                }, 100);
              }}
              className="flex items-center gap-3 px-8 py-4 rounded-full bg-gray-700/80 backdrop-blur-sm hover:bg-gray-600 transition-all hover:scale-105 border-2 shadow-xl"
              style={{ borderColor: currentColor }}
            >
              <Skull size={24} className="animate-pulse" />
              <span className="font-bold text-lg">ALEATÃ“RIO</span>
            </button>
            
            <button
              onClick={() => {
                setPlayAllMode(!playAllMode);
                setIsPlaying(!playAllMode);
              }}
              className="flex items-center gap-3 px-8 py-4 rounded-full transition-all hover:scale-105 border-2 shadow-xl font-bold text-lg"
              style={{ 
                backgroundColor: playAllMode ? currentColor : 'transparent',
                borderColor: currentColor,
                animation: playAllMode ? 'pulse 1s infinite' : 'none',
                boxShadow: playAllMode ? `0 0 30px ${currentColor}` : 'none'
              }}
            >
              <Zap size={24} className={playAllMode ? 'animate-bounce' : ''} />
              <span>PLAY ALL</span>
            </button>
            
            <button className="p-4 rounded-full bg-gray-700/80 backdrop-blur-sm hover:bg-gray-600 transition-all hover:scale-110 shadow-xl">
              <Volume2 size={24} />
            </button>
          </div>

          {/* Playlist */}
          <div className="max-h-96 overflow-y-auto space-y-2 px-2">
            {tracks.map((track, index) => (
              <div
                key={track.id}
                onClick={() => {
                  setIsPlaying(false);
                  setTimeout(() => {
                    setCurrentTrack(index);
                    setIsPlaying(true);
                  }, 100);
                }}
                className={`flex items-center justify-between p-4 rounded-xl cursor-pointer transition-all hover:scale-102 backdrop-blur-sm ${
                  currentTrack === index 
                    ? 'shadow-xl' 
                    : 'bg-black/20 hover:bg-black/30'
                }`}
                style={{
                  backgroundColor: currentTrack === index ? `${track.color}30` : undefined,
                  borderLeft: currentTrack === index ? `6px solid ${track.color}` : 'none',
                  boxShadow: currentTrack === index ? `0 0 20px ${track.color}40` : 'none'
                }}
              >
                <div className="flex items-center gap-4">
                  <div 
                    className="w-12 h-12 rounded-full flex items-center justify-center font-bold text-lg shadow-lg"
                    style={{ 
                      backgroundColor: track.color,
                      boxShadow: `0 0 15px ${track.color}60`
                    }}
                  >
                    {index + 1}
                  </div>
                  <div>
                    <p className="font-bold text-lg">{track.title}</p>
                    <p className={`text-sm ${themeClasses.secondary}`}>{track.artist}</p>
                  </div>
                </div>
                <span className={`text-sm ${themeClasses.secondary}`}>{track.duration}</span>
              </div>
            ))}
          </div>
        </div>

        {/* Footer */}
        <div className="text-center mt-8 opacity-70">
          <p className="text-lg mb-1">ðŸ¦‡ Gothic Post-Punk Collection ðŸ¦‡</p>
          <p className={themeClasses.secondary}>18 Tracks â€¢ Melancholic Vibes â€¢ Nocturnal Edition</p>
        </div>
      </div>
    </div>
  );
};

export default GothicMusicPlayer;
